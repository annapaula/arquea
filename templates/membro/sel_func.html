{% extends "admin/base_site.html" %}
{% block content %}
  <h2>Hor√°rios</h2>
  <script>
  var funcionarios = [];
  {% for func in funcionarios %}
      funcionarios.push({id:'{{ func.funcionario.id }}', nome:'{{ func.funcionario.nome }}', ano_inicio:'{{ func.ano_inicio }}', mes_inicio:'{{ func.mes_inicio }}', ano_fim:'{{ func.ano_fim }}', mes_fim:'{{ func.mes_fim }}'})
  {% endfor %}
  function get_funcionario() {
	  retorno = '';
      id = $('#form_funcionario').val();
      
      for (var i=0,len=funcionarios.length; i<len; i++) {
          if (funcionarios[i].id == id) {
        	  retorno = funcionarios[i];
          }
      }
      return retorno;
  }
  function mudar_funcionario() {
	    funcionario = get_funcionario();
	    $('#form_ano').empty();
	    $('#form_ano').append('<option value="0">Todos</option>');
	    for (var ano = funcionario.ano_inicio; ano <= funcionario.ano_fim; ano++) {
		   $('#form_ano').append('<option value="'+ano+'">'+ano+'</option>');
	    }
	    mudar_ano();
  }
 
  function mudar_ano() {
      funcionario = get_funcionario()
      ano = $('#form_ano').val();
      
      mes_fim = 12;
      if (ano == funcionario.ano_fim) {
          mes_fim = funcionario.mes_fim;
      }
      mes_inicio = 1;
      if (ano == funcionario.ano_inicio) {
          mes_inicio = funcionario.mes_inicio;
      }
      $('#form_mes').empty();
      $('#form_mes').append('<option value="0">Todos</option>');
      for (var mes = mes_inicio; mes <= mes_fim; mes++) {
         $('#form_mes').append('<option value="'+mes+'">'+mes+'</option>');
      }
  }
  
  </script>
 <form method="GET">
    <select id="form_funcionario" name="funcionario" onchange="mudar_funcionario();">
       <option value="-1">---</option>
       {% for func in funcionarios %}
       <option value="{{ func.funcionario.id }}">{{ func.funcionario.nome }}</option>
       {% endfor %}
    </select>
    <br />
    <select id='form_ano' name="ano" onchange="mudar_ano();">
       {% for ano in anos %}
       <option value="{{ ano }}">{% if ano == 0 %}Todos{% else %}{{ ano }}{% endif %}</option>
       {% endfor %}
    </select>
    <select id='form_mes' name="mes">
       {% for mes in meses %}
       <option value="{{ mes }}">{% if mes == 0 %}Todos{% else %}{{ mes }}{% endif %}</option>
       {% endfor %}
    </select>
    <input type="submit" value="Enviar">
 </form>
{% endblock %}

