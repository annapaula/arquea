{% extends "admin/base_site.html" %}
{% load proto_tags %}
{% block content %}
<style>
    #container {
        margin: 0 auto;
        width: 1680px;
    }
    #footer {
       width:inherit;
    }
    
    /* Estilos da tabela de dados consolidados*/
    #tbl_consolidado th {
        background-color:lightgray;
    }
    /* dimensões das celulas de titulo horizontal */
    #tbl_consolidado .tit_vert {
        display:block;
        width:70px;
        text-align:center;
    }
    /* dimensões das celulas de titulo vertical */
    #tbl_consolidado .peq span {
        height:37px;
        width:90px;
        display:block;
    }
    #tbl_consolidado td:not(:first-child) {
        white-space:nowrap;
    }
    /* bold para as somatorias */
    #tbl_consolidado td:nth-last-child(1),
    #tbl_consolidado td:nth-last-child(2) {
        font-weight:bold;
    }
    /* Bordas */
    #tbl_consolidado th {
        border-bottom: 1px black solid;
    }
    #tbl_consolidado th:nth-last-child(2),
    #tbl_consolidado td:nth-last-child(2) {
        border-left: 1px black solid;
    }
    #tbl_consolidado th:first-child,
    #tbl_consolidado td:first-child,
    #tbl_consolidado th:nth-child(2),
    #tbl_consolidado td:nth-child(2){
        border-right: 1px black solid;
    }
    #tbl_consolidado tr:nth-last-child(2) {
        border-top: 1px black solid;
    }
    
/* Estilo das tabelas de modalidades*/
    .tbl_modalidades {
    }
    .tbl_modalidades th {
        background-color:lightgray;
    }
    /* dimensões das celulas de titulo horizontal */
    .tbl_modalidades .tit_vert {
        display:block;
        width:70px;
        text-align:center;
    }
    .tbl_modalidades td:not(:nth-child(2)) {
        white-space:nowrap;
    }
    .tbl_modalidades th .span-desc {
        display:block;
        width:150px;
    }
    .tbl_modalidades th .span-conc {
        display:block;
        width:80px;
    }
    .tbl_modalidades th:nth-last-child(1) span {
        width:100px;
        display:block;
    }
    .tbl_modalidades th:nth-last-child(2) span {
        width:100px;
        display:block;
    }
    .tbl_modalidades th {
        border-bottom:1px black solid;
    }
    .tbl_modalidades th:nth-last-child(2),
    .tbl_modalidades td:nth-last-child(2) {
        border-left:1px black solid;
    }
    .tbl_modalidades th:nth-child(2),
    .tbl_modalidades td:nth-child(2),
    .tbl_modalidades th:nth-child(3),
    .tbl_modalidades td:nth-child(3) {
        border-right: 1px black solid;
    }
</style>
<h1>Relatório gerencial do processo {{ termo }}, atualizado em {{ atualizado|date:"d/m/Y" }}</h1>
<h4><a href="{% url 'financeiro.views.relatorio_gerencial' 1 %}?termo={{ termo.id }}">Imprimir</a></h4>

    <table border="1" cellpadding="5" id="tbl_consolidado">
    <tr><th>Modalidade</th><th><span>Concessão</span></th>
    {% for m in meses %}
      <th><span class="tit_vert">{{ m }}</span></th>
    {% endfor %}
    <th>Total realizado</th><th>Saldo</th></tr>
    {% for m in modalidades %}
	<tr><td class="peq"><span>{{ m.modalidade }}</span></td><td class="num peq"><b>{{ m.concedido }}</b></td>
	{% for v in m.meses|dictsort:"ord" %}
	  <td>{{ v.valor }}</td>
	{% endfor %}
        <td><b><span>{{ m.realizado|safe }}</span></b></td><td><b><span>{{ m.saldo|safe }}</span></b></td></tr>
    {% endfor %}
    <tr>
        <td>Total (R$)</td>
        <td><b>{{ gerais.concedido_real|moeda }}</b></td>
	    {% for t in totais|dictsort:"ord" %}
	        <td><b>{{ t.total_real|moeda }}</b></td>
	    {% endfor %}
	    <td><b>{{ gerais.gasto_real|moeda }}</b></td>
	    <td><b>{{ gerais.saldo_real|moeda }}</b></td>
    </tr>
    <tr>
        <td>Total (US$)</td>
        <td><b>{{ gerais.concedido_dolar|moeda:0 }}</b></td>
	    {% for t in totais|dictsort:"ord" %}
	        <td><b>{{ t.total_dolar|moeda:0 }}</b></td>
	    {% endfor %}
	    <td><b>{{ gerais.gasto_dolar|moeda:0 }}</b></td>
	    <td><b>{{ gerais.saldo_dolar|moeda:0 }}</b></td>
    </tr>
    </table>

{% for m in modalidades %}
  <h3>{{ m.modalidade.nome }}</h3>
  <table border="1" repeat="1" cellpadding="5" class="tbl_modalidades">
  </th><th>Qtd.</th><th><span class="span-desc">Descrição</span></th><th><span class="span-conc">Concessão</span></th>
    {% for m in meses %}
      <th><span class="tit_vert">{{ m }}</span></th>
    {% endfor %}
  <th><span>Total realizado</span></th><th><span>Saldo</span></th></tr>
  {% for it, valores in m.itens.items %}
     <tr><td>{{ it.quantidade }}</td><td>{{ it.descricao }}</td><td><b>{{ it.valor|moeda:m.modalidade.moeda_nacional }}</b></td>
     {% for v in valores|dictsort:"ord" %}<td>{{ v.valor }}</td>{% endfor %}
     <td><b><span>{{ it.mostra_valor_realizado }}</span></b></td><td><b><span>{{ it.saldo|moeda:m.modalidade.moeda_nacional }}</span></b></td></tr>
  {% endfor %}
  </table>
{% endfor %}
{% endblock %}
