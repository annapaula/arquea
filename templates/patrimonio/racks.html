{% extends "admin/base_site.html" %}
{% load proto_tags %}
{% load url from future %}
{% load i18n proto_tags admin_static %}
{% block extrahead %}
{% load static %}
{% get_static_prefix as STATIC_PREFIX %}

<link rel="stylesheet" type="text/css" href="{{ STATIC_PREFIX }}css/racks.css" />
<link rel="stylesheet" type="text/css" href="{% static "css/base-print.css" %}" />
<style type="text/css">
.u {
    background-image: url('{{ STATIC_PREFIX }}img/1u.png');
}
@media print {
  .u,
  .rack,
  .roteador,
  .interno,
  .dc,
  .u-n,
  .bloco-n, .page-break {
        -webkit-print-color-adjust: exact;
  }
  .u {}
  .equip {}
  .roteador {background:#81878b !important;}
  .espaco {}
  .interno {}
  .dc {}
  .u-n {}
  .bloco-n {}
}

 #wrap-form {
    width: 250px;
	height: 35px;
	position: relative;
	display: inline-block;
 }
 #icons {
    display: inline-block;
 }
 #icons img {
    margin:-10px;
 }
/**
    Exibe ou esconde as imagens dos stencils 
*/
 {% if chk_stencil == "0" %}
    .interno a img { display:none; }
 {% endif %}
/**
    Exibe ou esconde as legendas dos equipamentos 
*/
 {% if chk_legenda == "0" %}
    .interno a div div div { display:none; }
 {% endif %}
</style>
   <script type="text/javascript" src="{{ STATIC_PREFIX }}js/racks.js"></script>
   <script type="text/javascript" src="{{ STATIC_PREFIX }}js/admin/RelatedObjectLookups.js"></script>
{% endblock %}
{% block breadcrumbs %}
	{% if not is_popup %}
    <div class="breadcrumbs">Você está em: 
      <a href="../../">
        {% trans "Home" %}
      </a>
       &rsaquo;
       <a href="/patrimonio/racks"> 
        Diagrama de Racks Frontal
      </a>
    </div>
	{% endif %}
{% endblock %}
{% block content %}

<h1>Diagrama de Racks Frontal</h1>
<div id="wrap-form">
	<form id="form_racks" method="GET">
	Data Centers
	<select name="dc" onchange="this.form.submit();">
	    <option value="0">Todos</option>
	{% for dc in todos_dcs %}
	   <option value="{{ dc.id }}" {% if request.GET.dc == dc.id|lower %}selected{% endif %}>{{ dc.nome }}</option>
	{% endfor %}
	</select>
	</form>
</div>
{% if dcs %}
<div id="icons">
    <a href="{{ request.get_full_path  }}&pdf=2" class="printlink"><img src="{{ STATIC_URL }}img/icon-pdf.png" title="Exportar para PDF." /></a>
</div>
<form>
<input type="checkbox" id="chk_stencil" name="chk_stencil" value="1" {% if chk_stencil = 1 %}checked{% endif %}><span>&nbsp;Mostrar stencils</span><br>
<input type="checkbox" id="chk_legenda" name="chk_legenda" value="1" {% if chk_legenda = 1 %}checked{% endif %}><span>&nbsp;Mostrar legendas</span><br>
<input type="checkbox" id="chk_legenda_desc" name="chk_legenda_desc" value="1" {% if chk_legenda_desc = 1 %}checked{% endif %}><span>&nbsp;Mostrar descrição.</span>
</form>
    
	{% for dc in dcs %}
	   {% if not forloop.first %}
	       <div class="page-break"></div>
	   {% endif %}
	<div class="dc">
	<h1>{{ dc.entidade }} - {{ dc.nome }}</h1>
	{% for fileira in dc.fileiras %}
	<p></p>
	{% for rack in fileira.racks %}
		<div class="rack">
		    <h2>
		      <a href="{% url "admin:patrimonio_patrimonio_change" rack.id %}" onclick="return showAddAnotherPopup(this);">
		      {{ rack.nome }} ({{ rack.vazio }} ocupado)
		      </a>
		    </h2>
		    <div id="rack{{ dc.id }}_{{forloop.counter}}" class="bloco-n" style="height: {{ rack.altura_pxs }}px;">
		        {% for i in rack.altura_pts|get_range reversed %}
		            <div class="u-n"><div>{{ i|add:"1" }}</div></div>
		        {% endfor %}
		    </div>
		    <div class="u" style="height: {{ rack.altura_pxs }}px;"></div>
		    <div class="interno">
		  {% for eq in rack.equipamentos %}
		       {% if eq.id %}
		           <a href="{% url "admin:patrimonio_patrimonio_change" eq.id %}" onclick="return showAddAnotherPopup(this);">
		       {% endif %}
		       <div class="{% if eq.pos_col %} pos_{{eq.pos_col}} {% endif %} {% if eq.conflito %}conflito{% endif %} equip " rel="tooltip" title="{{ eq.descricao }}" 
		           style="margin-top:{{ eq.eixoY }}px; height:{{ eq.altura }}px;">
	               <div>
		               <div class="{% if eq.pos_col %} pos_{{eq.pos_col}} {% endif %}" style="height:{{ eq.altura }}px;">
		                {% if eq.pos_col %}
                            {% if eq.tam >= 9 %}
                                {{ eq.nome|default:""|truncatechars:50 }}            
                            {% elif eq.tam >= 6 %}
                                {{ eq.nome|default:""|truncatechars:35 }}
                            {% else %}
                                {{ eq.nome|default:""|truncatechars:20 }}
                            {% endif %}
				        {% else %}
				            {% if eq.tam >= 9 %}
				                {{ eq.nome|default:""|truncatechars:90 }}            
				            {% elif eq.tam >= 6 %}
				                {{ eq.nome|default:""|truncatechars:60 }}
				            {% else %}
				                {{ eq.nome|default:""|truncatechars:30 }}
				            {% endif %}
                        {% endif %}
			            </div>
                       <div class="{% if eq.pos_col %} pos_{{eq.pos_col}} {% endif %}" style="height:{{ eq.altura }}px;" style="position:absolute">
                        {% if eq.pos_col %}
                            {% if eq.tam >= 15 %}
                                {{ eq.descricao|truncatechars:80 }}
                            {% elif eq.tam >= 12 %}
                                {{ eq.descricao|truncatechars:65 }}
                            {% elif eq.tam >= 9 %}
                                {{ eq.descricao|truncatechars:50 }}            
                            {% elif eq.tam >= 6 %}
                                {{ eq.descricao|truncatechars:35 }}
                            {% else %}
                                {{ eq.descricao|truncatechars:20 }}
                            {% endif %}
                        {% else %}
                            {% if eq.tam >= 15 %}
                                {{ eq.descricao|truncatechars:150 }}
                            {% elif eq.tam >= 12 %}
                                {{ eq.descricao|truncatechars:120 }}
                            {% elif eq.tam >= 9 %}
                                {{ eq.descricao|truncatechars:90 }}            
                            {% elif eq.tam >= 6 %}
                                {{ eq.descricao|truncatechars:60 }}
                            {% else %}
                                {{ eq.descricao|truncatechars:30 }}
                            {% endif %}
                        {% endif %}
                        </div>
		            </div>
		            {% if eq.imagem %}<img src="{{ eq.imagem }}" />{% endif %}
		       </div>
		       
		       {% if eq.id %}
		           </a>
		       {% endif %}
		  {% endfor %}
		    </div>
		   <div class="u" style="height: {{ rack.altura_pxs }}px;"></div>
		{% if rack.equipamentos_fora_visao %}
            <div class="outros">
                <div class="outros-content">
                <table>
                    <caption class="outros-title">Outros equipamentos.</caption>
                    <tr>
                        <th>Desc</th>
                        <th>Tam</th>
                        <th>Pos</th>
                        <th>Col</th>
                    </tr>
                    {% for eq in rack.equipamentos_fora_visao %}
                        <tr>
	                        <td>
	    	                    <a href="{% url "admin:patrimonio_patrimonio_change" eq.id %}" onclick="return showAddAnotherPopup(this);">{{ eq.nome|truncatechars:45 }}</a>
	    	                </td>
	                        <td>{{ eq.tam }}</td>
	                        <td>{{ eq.pos }}</td>
	                        <td>{{ eq.pos_col }}</td>
                        </tr>
                    {% endfor %}
                </table>
                </div>
            </div>
           {% endif %}
		{% if rack.conflitos %}
	        <div class="conflitos">
	            <span class="conflitos-title">Avisos!</span>
	            <div class="conflitos-content">
	            <table>
	                <tr>
	                    <th>EQ</th>
	                    <th>Pos</th>
	                    <th>Alt</th>
	                </tr>
	                {% for conflito in rack.conflitos %}
	                    <tr class="conflito-tbl-obs">
	                       <td colspan=3>{{ conflito.obs }}</td>
	                    </tr>
	                    <tr>
	                       {% if conflito.eq1 %}
	                        <td>
	                           <a href="{% url "admin:patrimonio_patrimonio_change" conflito.eq1.id %}" onclick="return showAddAnotherPopup(this);">
	                            {{ conflito.eq1.nome }}
	                            </a>
	                        </td>
	                        <td>{{ conflito.eq1.pos }}</td>
	                        <td>{{ conflito.eq1.tam }}</td>
	                        {% endif %}
	                    </tr>
	                    <tr>
	                        {% if conflito.eq2 %}
	                        <td>
	                            <a href="{% url "admin:patrimonio_patrimonio_change" conflito.eq2.id %}" onclick="return showAddAnotherPopup(this);">
	                                {{ conflito.eq2.nome }}
	                            </a>
	                        </td>
	                        <td>{{ conflito.eq2.pos }}</td>
	                        <td>{{ conflito.eq2.tam }}</td>
	                        {% endif %}
	                    </tr>
	                {% endfor %}
	            </table>
	            </div>
	        </div>
	       {% endif %}
		</div>
	{% endfor %}
	{% endfor %}
{% endfor %}

{% else %}
    <button name="Buscar" onclick="document.getElementById('form_racks').submit();">Buscar</button>
{% endif %}
</div>

{% endblock %}
